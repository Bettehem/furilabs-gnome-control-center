From 5e7d48b7c26e9ee6d1f21a1f8c232855b431f568 Mon Sep 17 00:00:00 2001
From: Jeremy Bicha <jbicha@ubuntu.com>
Date: Thu, 14 Sep 2017 09:23:42 -0400
Subject: [PATCH] region: Add Language Selector button

Workaround for https://launchpad.net/bugs/1631750
---
 panels/region/cc-region-panel.c | 26 ++++++++++++++++++++++++++
 panels/region/region.ui         | 30 ++++++++++++++++++++++++++++++
 2 files changed, 56 insertions(+)

Index: gnome-control-center-3.26.0/panels/region/cc-region-panel.c
===================================================================
--- gnome-control-center-3.26.0.orig/panels/region/cc-region-panel.c
+++ gnome-control-center-3.26.0/panels/region/cc-region-panel.c
@@ -113,6 +113,7 @@ struct _CcRegionPanelPrivate {
         GtkWidget *move_down_input;
         GtkWidget *show_config;
         GtkWidget *show_layout;
+        GtkWidget *language_support_button;
 
         GSettings *input_settings;
         GnomeXkbInfo *xkb_info;
@@ -1398,6 +1399,33 @@ show_selected_settings (CcRegionPanel *s
         g_object_unref (ctx);
 }
 
+
+static void
+show_language_support (CcRegionPanel *self)
+{
+        GAppInfo *app_info;
+        GdkAppLaunchContext *ctx;
+        GError *error = NULL;
+
+        app_info = G_APP_INFO (g_desktop_app_info_new ("gnome-language-selector.desktop"));
+
+        if (app_info) {
+                ctx = gdk_display_get_app_launch_context (gdk_display_get_default ());
+                g_app_info_launch (app_info, NULL, G_APP_LAUNCH_CONTEXT (ctx), &error);
+        } else {
+                g_warning ("Failed to launch language-selector: couldn't create GDesktopAppInfo");
+                return;
+        }
+
+        if (error) {
+                g_warning ("Failed to launch language-selector: %s", error->message);
+                g_error_free (error);
+        }
+
+       g_object_unref (app_info);
+       g_object_unref (ctx);
+}
+
 static void
 show_selected_layout (CcRegionPanel *self)
 {
@@ -1510,6 +1538,7 @@ setup_input_section (CcRegionPanel *self
         priv->move_down_input = WID ("input_source_down");
         priv->show_config = WID ("input_source_config");
         priv->show_layout = WID ("input_source_layout");
+        priv->language_support_button = WID ("language-support-button");
 
         g_signal_connect_swapped (priv->options_button, "clicked",
                                   G_CALLBACK (show_input_options), self);
@@ -1525,6 +1554,8 @@ setup_input_section (CcRegionPanel *self
                                   G_CALLBACK (show_selected_settings), self);
         g_signal_connect_swapped (priv->show_layout, "clicked",
                                   G_CALLBACK (show_selected_layout), self);
+        g_signal_connect_swapped (priv->language_support_button, "clicked",
+                                  G_CALLBACK (show_language_support), self);
 
         cc_list_box_setup_scrolling (GTK_LIST_BOX (priv->input_list), 5);
 
Index: gnome-control-center-3.26.0/panels/region/region.ui
===================================================================
--- gnome-control-center-3.26.0.orig/panels/region/region.ui
+++ gnome-control-center-3.26.0/panels/region/region.ui
@@ -534,6 +534,31 @@
            </style>
           </object>
         </child>
+        <child>
+          <object class="GtkBox">
+            <property name="visible">True</property>
+            <property name="can_focus">False</property>
+            <property name="orientation">vertical</property>
+            <child>
+              <object class="GtkButton" id="language-support-button">
+                <property name="label" translatable="yes">Manage Installed Languages</property>
+                <property name="visible">True</property>
+                <property name="can_focus">True</property>
+                <property name="receives_default">True</property>
+              </object>
+              <packing>
+                <property name="expand">False</property>
+                <property name="fill">True</property>
+                <property name="pack_type">end</property>
+              </packing>
+            </child>
+          </object>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">True</property>
+            <property name="position">3</property>
+          </packing>
+        </child>
       </object>
     </child>
   </object>
